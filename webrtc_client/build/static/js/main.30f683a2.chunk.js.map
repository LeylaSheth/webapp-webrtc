{"version":3,"sources":["common/room-manager.ts","common/logger-manager.ts","common/stream-manager.ts","common/rtc-manager.ts","components/live-player/live-player.tsx","components/local-preview/local-preview.tsx","components/remote-preview/remote-preview.tsx","components/theme-switch/theme-switch.tsx","components/devices-setup/devices-setup.tsx","components/header/header.tsx","components/room-setup/room-setup.tsx","pages/one-on-one/style.ts","components/logger/logger.tsx","pages/one-on-one/one-on-one.tsx","pages/one-on-one/hooks/use-local-stream.ts","pages/one-on-one/hooks/use-room.ts","pages/one-on-one/hooks/use-device.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["RoomState","logger","logMessage","this","message","type","streamManager","localStream","remoteStream","localStreamChangeListeners","remoteStreamChangeListeners","a","window","navigator","mediaDevices","getUserMedia","video","audio","videoDid","audioDid","deviceId","exact","then","stream","forEach","listener","catch","e","console","error","resetLocalStream","push","targetIndex","indexOf","splice","track","addTrack","MediaStream","RTCManager","connection","rtcMessage","RTCPeerConnection","iceServers","urls","username","credential","iceTransportPolicy","iceCandidatePoolSize","addEventListener","log","candidate","addLogMessage","roomManager","sendMessage","toJSON","addTrackToRemoteStream","iceConnectionState","iceGatheringState","getLocalStream","getTracks","label","createOffer","offerToReceiveAudio","offerToReceiveVideo","offer","setLocalDescription","setRemoteDescription","createAnswer","answer","addIceCandidate","resetRemoteStream","close","roomId","socket","roomState","leave","rtcManager","roomStateChangeListeners","state","socketDisconnect","io","on","socketId","userCount","setState","joined","undefined","alert","data","setRemoteOffer","setRemoteAnswer","addCandidate","emit","disconnect","localRoomId","socketConnect","Loading","styled","CircularProgress","position","left","top","LivePlayer","videoRef","loading","className","ref","autoPlay","muted","LocalPreview","videoSelected","audioSelected","useRef","useState","setLoading","useEffect","handleStreamChange","current","srcObject","addListener","removeListener","start","RemoteVideo","ColorModeContext","createContext","toggleColorMode","ThemeSwitch","theme","useTheme","colorMode","useContext","IconButton","sx","ml","onClick","color","palette","mode","BrightnessLow","BrightnessHigh","DevicesSetup","props","videoDevices","audioDevices","handleVideoSelect","onVideoSelect","handleAudioSelect","onAudioSelect","handleReset","onReset","Stack","FormControl","FormLabel","RadioGroup","onChange","map","device","FormControlLabel","value","control","Radio","checked","Divider","Button","pages","text","link","Header","anchorElNav","setAnchorElNav","handleCloseNavMenu","AppBar","maxHeight","boxSizing","Container","maxWidth","Toolbar","disableGutters","Typography","variant","noWrap","component","mr","display","xs","md","Box","flexGrow","size","aria-label","aria-controls","aria-haspopup","event","currentTarget","Menu","id","anchorEl","anchorOrigin","vertical","horizontal","keepMounted","transformOrigin","open","Boolean","onClose","page","MenuItem","to","textAlign","my","RoomSetup","enterDisabled","leaveDisabled","setRoomId","handleInput","useCallback","Number","target","handleJoin","join","handleLeft","TextField","required","fullWidth","disabled","PaperSection","Paper","secondary","lineHeight","padding","spacing","margin","Logger","getLogMessage","setValue","loggerRef","timer","setInterval","latestMessage","textArea","querySelector","scrollTop","scrollHeight","clearInterval","multiline","rows","overflow","Producer","localStreamReady","setLocalStreamReady","handleLocalStreamReady","useLocalStream","setRoomState","handleRoomStateChange","useRoom","setVideoDevices","setAudioDevices","setVideoSelected","setAudioSelected","handleDeviceChange","enumerateDevices","devices","filter","d","kind","requestPermission","removeEventListener","useDevice","Grid","container","style","height","item","elevation","App","setMode","useMemo","prevMode","createTheme","Provider","ThemeProvider","bgcolor","path","element","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.30f683a2.chunk.js","sourcesContent":["import { io, Socket } from \"socket.io-client\";\nimport { logger } from \"./logger-manager\";\nimport { RTCManager } from \"./rtc-manager\";\n\nexport enum RoomState {\n  leave = \"leave\",\n  joined = \"joined\",\n  joined_conn = \"joined_conn\",\n}\n\nexport type RoomStateChangListener = (state: RoomState) => void;\n\nexport interface RoomEventMap {\n  roomStateChange: RoomStateChangListener;\n}\n\nclass RoomManager {\n  private roomId: number | undefined;\n\n  private socket: Socket | undefined;\n\n  private roomState: RoomState = RoomState.leave;\n\n  private rtcManager: RTCManager | undefined;\n\n  private roomStateChangeListeners: RoomStateChangListener[] = [];\n\n  private setState(state: RoomState) {\n    this.roomState = state;\n    this.roomStateChangeListeners.forEach((listener) => listener(state));\n  }\n\n  private socketConnect() {\n    this.socketDisconnect();\n    if (process.env.NODE_ENV === \"development\") {\n      this.socket = io(\"localhost:3001\");\n    } else {\n      this.socket = io(\"socket.xulin.fun\");\n    }\n\n    this.socket.on(\"joined\", (roomId, socketId, userCount) => {\n      logger.addLogMessage(\n        `receive joined message: ${roomId} ${socketId} ${userCount}\\n`,\n        \"room\"\n      );\n      console.log(`receive joined message: ${roomId} ${socketId} ${userCount}`);\n      this.roomId = roomId;\n      this.setState(RoomState.joined);\n\n      if (userCount > 1) {\n        this.rtcManager = new RTCManager();\n      }\n    });\n\n    this.socket.on(\"other_join\", (roomId, socketId, userCount) => {\n      console.log(\"receive other_join message\", roomId, socketId, userCount);\n\n      if (!this.rtcManager) {\n        this.rtcManager = new RTCManager();\n      }\n\n      this.rtcManager.createOffer().then((offer) => {\n        this.sendMessage(offer);\n      });\n    });\n\n    this.socket.on(\"full\", () => {\n      this.socketDisconnect();\n      this.rtcManager?.close();\n      this.rtcManager = undefined;\n      alert(\"房间已满！\");\n    });\n\n    this.socket.on(\"left\", () => {\n      this.setState(RoomState.leave);\n      this.socketDisconnect();\n    });\n\n    this.socket.on(\"bye\", () => {\n      this.setState(RoomState.leave);\n      this.rtcManager?.close();\n      this.rtcManager = undefined;\n    });\n\n    this.socket.on(\"message\", (roomId, data) => {\n      console.log(\"received message --->\", data);\n      const type = data?.type;\n      switch (type) {\n        case \"offer\":\n          this.rtcManager?.setRemoteOffer(data).then((answer) => {\n            this.sendMessage(answer);\n          });\n          break;\n        case \"answer\":\n          this.rtcManager?.setRemoteAnswer(data);\n          break;\n        case \"icecandidate\":\n          if (data.candidate) {\n            this.rtcManager?.addCandidate(data.candidate);\n          } else {\n            console.log(\"this is the end of candidate\");\n          }\n          break;\n        default:\n          console.error(\"can not handle message\", data);\n      }\n    });\n  }\n\n  sendMessage(data: any) {\n    console.log(\"sendMessage\", this.roomId, data);\n    this.socket?.emit(\"message\", this.roomId, data);\n  }\n\n  private socketDisconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = undefined;\n    }\n  }\n\n  join(localRoomId: number) {\n    this.socketConnect();\n    this.socket?.emit(\"join\", localRoomId);\n  }\n\n  left() {\n    this.socket?.emit(\"leave\", this.roomId);\n    this.rtcManager?.close();\n    this.rtcManager = undefined;\n  }\n\n  addListener<K extends keyof RoomEventMap>(\n    type: K,\n    listener: RoomEventMap[K]\n  ) {\n    if (type === \"roomStateChange\") {\n      this.roomStateChangeListeners.push(listener);\n    }\n  }\n\n  removeListener<K extends keyof RoomEventMap>(\n    type: K,\n    listener: RoomEventMap[K]\n  ) {\n    if (type === \"roomStateChange\") {\n      const targetIndex = this.roomStateChangeListeners.indexOf(listener);\n      if (targetIndex > -1) {\n        this.roomStateChangeListeners.splice(targetIndex, 1);\n      }\n    }\n  }\n}\n\nexport const roomManager = new RoomManager();\n","export class Logger {\n  public logMessage: string = \"\";\n  constructor() {\n    this.logMessage = \"\";\n  }\n\n  addLogMessage(message: string, type: \"rtc\" | \"room\") {\n    this.logMessage += `[${type}]:${message}`;\n  }\n\n  getLogMessage() {\n    return this.logMessage;\n  }\n}\n\nexport const logger = new Logger();\n","export type StreamChangeListener = (stream: MediaStream | null) => void;\n\nexport interface StreamEventMap {\n  localStreamChange: StreamChangeListener;\n  remoteStreamChange: StreamChangeListener;\n}\n\nclass StreamManager {\n  private localStream: MediaStream | null = null;\n\n  private remoteStream: MediaStream | null = null;\n\n  private localStreamChangeListeners: StreamChangeListener[] = [];\n\n  private remoteStreamChangeListeners: StreamChangeListener[] = [];\n\n  async requestPermission() {\n    await window.navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n  }\n\n  start(videoDid: string, audioDid: string) {\n    if (videoDid && audioDid) {\n      window.navigator.mediaDevices\n        .getUserMedia({\n          video: {\n            deviceId: {\n              exact: videoDid,\n            },\n          },\n          audio: {\n            deviceId: {\n              exact: audioDid,\n            },\n          },\n        })\n        .then((stream) => {\n          this.localStream = stream;\n          this.localStreamChangeListeners.forEach((listener) =>\n            listener(stream)\n          );\n        })\n        .catch((e) => {\n          console.error(\"get stream error !!!\", e);\n        });\n    } else {\n      this.resetLocalStream();\n    }\n  }\n\n  addListener<K extends keyof StreamEventMap>(\n    type: K,\n    listener: StreamEventMap[K]\n  ) {\n    if (type === \"localStreamChange\") {\n      this.localStreamChangeListeners.push(listener);\n      if (this.localStream) {\n        listener(this.localStream);\n      }\n    } else if (type === \"remoteStreamChange\") {\n      this.remoteStreamChangeListeners.push(listener);\n      if (this.remoteStream) {\n        listener(this.remoteStream);\n      }\n    }\n  }\n\n  removeListener<K extends keyof StreamEventMap>(\n    type: K,\n    listener: StreamEventMap[K]\n  ) {\n    if (type === \"localStreamChange\") {\n      const targetIndex = this.localStreamChangeListeners.indexOf(listener);\n      if (targetIndex > -1) {\n        this.localStreamChangeListeners.splice(targetIndex, 1);\n      }\n    } else if (type === \"remoteStreamChange\") {\n      const targetIndex = this.remoteStreamChangeListeners.indexOf(listener);\n      if (targetIndex > -1) {\n        this.remoteStreamChangeListeners.splice(targetIndex, 1);\n      }\n    }\n  }\n\n  getLocalStream() {\n    return this.localStream;\n  }\n\n  resetLocalStream() {\n    this.localStream = null;\n    this.localStreamChangeListeners.forEach((listener) => {\n      listener(this.localStream);\n    });\n  }\n\n  resetRemoteStream() {\n    this.remoteStream = null;\n    this.remoteStreamChangeListeners.forEach((listener) => {\n      listener(this.remoteStream);\n    });\n  }\n\n  addTrackToRemoteStream(track: MediaStreamTrack) {\n    if (this.remoteStream) {\n      this.remoteStream.addTrack(track);\n    } else {\n      this.remoteStream = new MediaStream([track]);\n    }\n    this.remoteStreamChangeListeners.forEach((listener) => {\n      listener(this.remoteStream);\n    });\n  }\n}\n\nexport const streamManager = new StreamManager();\n","import { streamManager } from \"./stream-manager\";\nimport { roomManager } from \"./room-manager\";\nimport { logger } from \"./logger-manager\";\n\nexport class RTCManager {\n  private connection: RTCPeerConnection;\n  public rtcMessage: string = \"\";\n\n  constructor() {\n    this.connection = new RTCPeerConnection({\n      iceServers: [\n        {\n          urls: \"turn:xulin.fun:3478\",\n          username: \"aaaaaa\",\n          credential: \"bbbbbb\",\n        },\n      ],\n      iceTransportPolicy: \"relay\",\n      iceCandidatePoolSize: 0,\n    });\n\n    this.connection.addEventListener(\"icecandidate\", (e) => {\n      console.log(`icecandidate: ${e.candidate}`);\n      logger.addLogMessage(`icecandidate: ${e.candidate}\\n`, \"rtc\");\n      roomManager.sendMessage({\n        type: \"icecandidate\",\n        candidate: e.candidate?.toJSON(),\n      });\n    });\n\n    this.connection.addEventListener(\"track\", (e) => {\n      console.log(\"track\", e);\n      logger.addLogMessage(`track: ${e}`, \"rtc\");\n      streamManager.addTrackToRemoteStream(e.track);\n    });\n\n    this.connection.addEventListener(\"iceconnectionstatechange\", (e) => {\n      console.log(\n        \"iceconnectionstatechange -->\",\n        this.connection.iceConnectionState\n      );\n      logger.addLogMessage(\n        `iceconnectionstatechange -->${this.connection.iceConnectionState}\\n`,\n        \"rtc\"\n      );\n    });\n\n    this.connection.addEventListener(\"icegatheringstatechange\", () => {\n      console.log(\n        \"icegatheringstatechange --->\",\n        this.connection.iceGatheringState\n      );\n      logger.addLogMessage(\n        `icegatheringstatechange --->${this.connection.iceGatheringState}\\n`,\n        \"rtc\"\n      );\n    });\n\n    streamManager\n      .getLocalStream()\n      ?.getTracks()\n      .forEach((track) => {\n        console.log(\"add local track --->\", track.label);\n        logger.addLogMessage(`add local track --->${track.label}\\n`, \"rtc\");\n        this.connection.addTrack(track);\n      });\n  }\n\n  async createOffer() {\n    const offer = await this.connection.createOffer({\n      offerToReceiveAudio: true,\n      offerToReceiveVideo: true,\n    });\n    console.log(\"createOffer --->\", offer);\n    logger.addLogMessage(`createOffer --->${offer}\\n`, \"rtc\");\n\n    this.connection.setLocalDescription(offer).then(() => {\n      console.log(\"LocalDescription is set\");\n      logger.addLogMessage(\"LocalDescription is set\\n\", \"rtc\");\n    });\n\n    return offer;\n  }\n\n  async setRemoteOffer(offer: RTCSessionDescriptionInit) {\n    this.connection.setRemoteDescription(offer).then(() => {\n      console.log(\"RemoteDescription is set\");\n      logger.addLogMessage(\"RemoteDescription is set\\n\", \"rtc\");\n    });\n    const answer = await this.connection.createAnswer({\n      offerToReceiveAudio: true,\n      offerToReceiveVideo: true,\n    });\n\n    this.connection.setLocalDescription(answer).then(() => {\n      console.log(\"LocalDescription is set\");\n      logger.addLogMessage(\"LocalDescription is set\\n\", \"rtc\");\n    });\n\n    return answer;\n  }\n\n  async setRemoteAnswer(answer: RTCSessionDescriptionInit) {\n    await this.connection.setRemoteDescription(answer);\n    console.log(\"RemoteDescription is set\");\n    logger.addLogMessage(\"RemoteDescription is set\\n\", \"rtc\");\n  }\n\n  async addCandidate(candidate: RTCIceCandidate) {\n    await this.connection.addIceCandidate(candidate);\n    logger.addLogMessage(\"IceCandidate added\\n\", \"rtc\");\n    console.log(`IceCandidate added`);\n  }\n\n  getMessage() {\n    return this.rtcMessage;\n  }\n\n  close() {\n    streamManager.resetRemoteStream();\n    this.connection.close();\n  }\n}\n","import { CircularProgress, styled } from \"@mui/material\";\nimport { FC, MutableRefObject } from \"react\";\nimport \"./style.scss\";\n\nexport interface LivePlayerProps {\n  videoRef: MutableRefObject<HTMLVideoElement | null>;\n  loading: boolean;\n}\n\nconst Loading = styled(CircularProgress)({\n  position: \"absolute\",\n  left: \"calc(50% - 20px)\",\n  top: \"calc(50% - 20px)\",\n});\n\nexport const LivePlayer: FC<LivePlayerProps> = ({ videoRef, loading }) => {\n  return (\n    <div className=\"live-player-container\">\n      {loading && <Loading />}\n      <video ref={videoRef} autoPlay muted />\n    </div>\n  );\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { StreamChangeListener, streamManager } from \"../../common\";\nimport { LivePlayer } from \"../live-player\";\nimport \"./style.scss\";\n\nexport interface LocalPreviewProps {\n  videoSelected?: string;\n  audioSelected?: string;\n}\n\nexport const LocalPreview: React.FC<LocalPreviewProps> = ({\n  videoSelected = \"\",\n  audioSelected = \"\",\n}) => {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const handleStreamChange: StreamChangeListener = (stream) => {\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        setLoading(false);\n      }\n      if (!stream) {\n        setLoading(true);\n      }\n    };\n    streamManager.addListener(\"localStreamChange\", handleStreamChange);\n\n    return () => {\n      streamManager.removeListener(\"localStreamChange\", handleStreamChange);\n    };\n  }, []);\n\n  useEffect(() => {\n    streamManager.start(videoSelected, audioSelected);\n  }, [videoSelected, audioSelected]);\n\n  return (\n    <div className=\"container\">\n      <div>local preview:</div>\n      <LivePlayer videoRef={videoRef} loading={loading} />\n    </div>\n  );\n};\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { StreamChangeListener, streamManager } from \"../../common\";\r\nimport { LivePlayer } from \"../live-player\";\r\nimport \"./style.scss\";\r\n\r\nexport interface RemoteVideoProps {\r\n  className?: string;\r\n}\r\n\r\nexport const RemoteVideo: React.FC<RemoteVideoProps> = ({ className }) => {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const handleStreamChange: StreamChangeListener = (stream) => {\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        setLoading(false);\r\n      }\r\n      if (!stream) {\r\n        setLoading(true);\r\n      }\r\n    };\r\n\r\n    streamManager.addListener(\"remoteStreamChange\", handleStreamChange);\r\n\r\n    return () => {\r\n      streamManager.removeListener(\"remoteStreamChange\", handleStreamChange);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div>remote video:</div>\r\n      <LivePlayer videoRef={videoRef} loading={loading} />\r\n    </div>\r\n  );\r\n};\r\n","import { IconButton, useTheme } from \"@mui/material\";\nimport { createContext, useContext } from \"react\";\nimport { BrightnessLow, BrightnessHigh } from \"@mui/icons-material\";\n\nexport const ColorModeContext = createContext({ toggleColorMode: () => {} });\n\nexport const ThemeSwitch = () => {\n  const theme = useTheme();\n  const colorMode = useContext(ColorModeContext);\n  return (\n    <IconButton\n      sx={{ ml: 1 }}\n      onClick={colorMode.toggleColorMode}\n      color=\"inherit\"\n    >\n      {theme.palette.mode === \"dark\" ? <BrightnessLow /> : <BrightnessHigh />}\n    </IconButton>\n  );\n};\n","import {\n  Button,\n  Divider,\n  FormControl,\n  FormControlLabel,\n  FormLabel,\n  Radio,\n  RadioGroup,\n  Stack,\n} from \"@mui/material\";\nimport { FC, ChangeEvent } from \"react\";\n\nexport interface DeviceSetupProps {\n  videoDevices: MediaDeviceInfo[];\n  audioDevices: MediaDeviceInfo[];\n  videoSelected: string;\n  audioSelected: string;\n  onVideoSelect: (event: ChangeEvent<HTMLInputElement>) => void;\n  onAudioSelect: (event: ChangeEvent<HTMLInputElement>) => void;\n  onReset: () => void;\n}\n\nexport const DevicesSetup: FC<DeviceSetupProps> = (props) => {\n  const {\n    videoDevices,\n    audioDevices,\n    videoSelected,\n    audioSelected,\n    onVideoSelect: handleVideoSelect,\n    onAudioSelect: handleAudioSelect,\n    onReset: handleReset,\n  } = props;\n\n  return (\n    <Stack>\n      <FormControl>\n        <FormLabel>Video Device Selector</FormLabel>\n        <RadioGroup onChange={handleVideoSelect}>\n          {videoDevices.map((device) => (\n            <FormControlLabel\n              key={device.deviceId}\n              value={device.deviceId}\n              control={<Radio checked={device.deviceId === videoSelected} />}\n              label={device.label}\n            />\n          ))}\n        </RadioGroup>\n      </FormControl>\n      <Divider />\n      <FormControl>\n        <FormLabel>Audio Device Selector</FormLabel>\n        <RadioGroup onChange={handleAudioSelect}>\n          {audioDevices.map((device) => (\n            <FormControlLabel\n              key={device.deviceId}\n              value={device.deviceId}\n              control={<Radio checked={device.deviceId === audioSelected} />}\n              label={device.label}\n            />\n          ))}\n        </RadioGroup>\n      </FormControl>\n      <Button onClick={handleReset}>Reset</Button>\n    </Stack>\n  );\n};\n","import {\n  AppBar,\n  Container,\n  Toolbar,\n  Typography,\n  Box,\n  IconButton,\n  Menu,\n  MenuItem,\n  Button,\n} from \"@mui/material\";\nimport { useState, MouseEvent, FC } from \"react\";\nimport { ThemeSwitch } from \"../theme-switch\";\nimport { Menu as MenuIcon } from \"@mui/icons-material\";\nimport { Link } from \"react-router-dom\";\n\nconst pages = [{ text: \"OneOnOne\", link: \"/one-on-one\" }];\n\nexport const Header: FC = () => {\n  const [anchorElNav, setAnchorElNav] = useState<null | HTMLElement>(null);\n\n  const handleOpenNavMenu = (event: MouseEvent<HTMLElement>) => {\n    setAnchorElNav(event.currentTarget);\n  };\n\n  const handleCloseNavMenu = () => {\n    setAnchorElNav(null);\n  };\n\n  return (\n    <AppBar\n      position=\"relative\"\n      color=\"inherit\"\n      sx={{ maxHeight: \"64px\", boxSizing: \"border-box\" }}\n    >\n      <Container maxWidth=\"xl\">\n        <Toolbar disableGutters>\n          <Typography\n            variant=\"h6\"\n            noWrap\n            component=\"div\"\n            sx={{ mr: 2, display: { xs: \"none\", md: \"flex\" } }}\n          >\n            LOGO\n          </Typography>\n\n          <Box sx={{ flexGrow: 1, display: { xs: \"flex\", md: \"none\" } }}>\n            <IconButton\n              size=\"large\"\n              aria-label=\"account of current user\"\n              aria-controls=\"menu-appbar\"\n              aria-haspopup=\"true\"\n              onClick={handleOpenNavMenu}\n              color=\"inherit\"\n            >\n              <MenuIcon />\n            </IconButton>\n            <Menu\n              id=\"menu-appbar\"\n              anchorEl={anchorElNav}\n              anchorOrigin={{\n                vertical: \"bottom\",\n                horizontal: \"left\",\n              }}\n              keepMounted\n              transformOrigin={{\n                vertical: \"top\",\n                horizontal: \"left\",\n              }}\n              open={Boolean(anchorElNav)}\n              onClose={handleCloseNavMenu}\n              sx={{\n                display: { xs: \"block\", md: \"none\" },\n              }}\n            >\n              {pages.map((page) => (\n                <MenuItem key={page.text} onClick={handleCloseNavMenu}>\n                  <Link to={page.link}>\n                    <Typography textAlign=\"center\">{page.text}</Typography>\n                  </Link>\n                </MenuItem>\n              ))}\n            </Menu>\n          </Box>\n          <Typography\n            variant=\"h6\"\n            noWrap\n            component=\"div\"\n            sx={{ flexGrow: 1, display: { xs: \"flex\", md: \"none\" } }}\n          >\n            LOGO\n          </Typography>\n          <Box sx={{ flexGrow: 1, display: { xs: \"none\", md: \"flex\" } }}>\n            {pages.map((page) => (\n              <Link key={page.text} to={page.link}>\n                <Button\n                  onClick={handleCloseNavMenu}\n                  sx={{ my: 2, color: \"text.primary\", display: \"block\" }}\n                >\n                  {page.text}\n                </Button>\n              </Link>\n            ))}\n          </Box>\n\n          <Box sx={{ flexGrow: 0 }}>\n            <ThemeSwitch />\n          </Box>\n        </Toolbar>\n      </Container>\n    </AppBar>\n  );\n};\n","import { Button, TextField } from \"@mui/material\";\nimport { ChangeEventHandler, FC, useCallback, useState } from \"react\";\nimport { roomManager } from \"../../common\";\n\nexport interface RoomSetupProps {\n  enterDisabled: boolean;\n  leaveDisabled: boolean;\n}\n\nexport const RoomSetup: FC<RoomSetupProps> = ({\n  enterDisabled,\n  leaveDisabled,\n}) => {\n  const [roomId, setRoomId] = useState(0);\n\n  const handleInput = useCallback<ChangeEventHandler<HTMLInputElement>>((e) => {\n    setRoomId(Number(e.target.value) || 0);\n  }, []);\n\n  const handleJoin = useCallback(() => {\n    roomManager.join(roomId);\n  }, [roomId]);\n\n  const handleLeft = useCallback(() => {\n    roomManager.left();\n  }, []);\n  return (\n    <div className=\"room-setting\">\n      <TextField\n        required\n        id=\"outlined-required\"\n        label=\"RoomId\"\n        value={roomId}\n        fullWidth\n        onChange={handleInput}\n        size=\"small\"\n      />\n\n      <div>\n        <Button\n          variant=\"contained\"\n          onClick={handleJoin}\n          disabled={enterDisabled}\n        >\n          Enter Room\n        </Button>\n\n        <Button\n          variant=\"outlined\"\n          color=\"error\"\n          onClick={handleLeft}\n          disabled={leaveDisabled}\n        >\n          Leave Room\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import { Paper } from \"@mui/material\";\nimport { styled } from \"@mui/system\";\n\nexport const PaperSection = styled(Paper)(({ theme }) => ({\n  color: theme.palette.text.secondary,\n  lineHeight: \"60px\",\n  padding: theme.spacing(2),\n  margin: theme.spacing(1),\n  boxSizing: \"border-box\",\n}));\n","import { TextField } from \"@mui/material\";\nimport { FC, useEffect, useRef, useState } from \"react\";\nimport { logger } from \"../../common\";\n\nexport const Logger: FC = () => {\n  const [value, setValue] = useState(logger.getLogMessage());\n  const loggerRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    let timer: number;\n    timer = window.setInterval(() => {\n      const latestMessage = logger.getLogMessage();\n      if (latestMessage !== value) {\n        setValue(latestMessage);\n        const textArea = loggerRef.current?.querySelector(\"[rows='30']\");\n        if (textArea) {\n          textArea.scrollTop = textArea.scrollHeight;\n        }\n      }\n    }, 1000);\n    return () => {\n      if (timer) {\n        window.clearInterval(timer);\n      }\n    };\n  });\n  return (\n    <TextField\n      ref={loggerRef}\n      fullWidth\n      label=\"Logger\"\n      multiline\n      disabled\n      value={value}\n      rows={30}\n      sx={{ overflow: \"auto\" }}\n    />\n  );\n};\n","import \"webrtc-adapter\";\nimport React from \"react\";\nimport { RoomState } from \"../../common\";\nimport {\n  RemoteVideo,\n  LocalPreview,\n  DevicesSetup,\n  RoomSetup,\n} from \"../../components\";\nimport \"./style.scss\";\nimport { useDevice, useLocalStream, useRoom } from \"./hooks\";\nimport { Grid } from \"@mui/material\";\nimport { PaperSection } from \"./style\";\nimport { Logger } from \"../../components/logger\";\n\nexport const Producer: React.FC = () => {\n  const { localStreamReady } = useLocalStream();\n  const { roomState } = useRoom();\n  const {\n    videoSelected,\n    audioSelected,\n    videoDevices,\n    audioDevices,\n    handleVideoSelect,\n    handleAudioSelect,\n    handleReset,\n  } = useDevice();\n\n  return (\n    <Grid container padding={1} style={{ height: \"calc(100% - 64px)\" }}>\n      <Grid item xs={3}>\n        <PaperSection elevation={8}>\n          <DevicesSetup\n            videoDevices={videoDevices}\n            onVideoSelect={handleVideoSelect}\n            audioDevices={audioDevices}\n            onAudioSelect={handleAudioSelect}\n            videoSelected={videoSelected}\n            audioSelected={audioSelected}\n            onReset={handleReset}\n          />\n        </PaperSection>\n        <PaperSection elevation={8}>\n          <RoomSetup\n            enterDisabled={!localStreamReady || roomState !== RoomState.leave}\n            leaveDisabled={roomState === RoomState.leave}\n          />\n        </PaperSection>\n      </Grid>\n      <Grid item xs sx={{ height: \"100%\" }}>\n        <PaperSection elevation={8}>\n          <LocalPreview\n            videoSelected={videoSelected}\n            audioSelected={audioSelected}\n          />\n          <RemoteVideo />\n        </PaperSection>\n      </Grid>\n      <Grid item xs={3} sx={{ height: \"100%\", maxHeight: \"100%\" }}>\n        <PaperSection elevation={8}>\n          <Logger />\n        </PaperSection>\n      </Grid>\n    </Grid>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport { StreamChangeListener, streamManager } from \"../../../common\";\n\nexport const useLocalStream = () => {\n  const [localStreamReady, setLocalStreamReady] = useState(false);\n  useEffect(() => {\n    const handleLocalStreamReady: StreamChangeListener = (stream) => {\n      setLocalStreamReady(!!stream);\n    };\n\n    streamManager.addListener(\"localStreamChange\", handleLocalStreamReady);\n\n    return () => {\n      streamManager.removeListener(\"localStreamChange\", handleLocalStreamReady);\n    };\n  }, []);\n\n  return { localStreamReady };\n};\n\n","import { useEffect, useState } from \"react\";\nimport {\n  roomManager,\n  RoomState,\n  RoomStateChangListener,\n} from \"../../../common\";\n\nexport const useRoom = () => {\n  const [roomState, setRoomState] = useState<RoomState>(RoomState.leave);\n\n  useEffect(() => {\n    const handleRoomStateChange: RoomStateChangListener = (state) => {\n      setRoomState(state);\n    };\n\n    roomManager.addListener(\"roomStateChange\", handleRoomStateChange);\n\n    return () => {\n      roomManager.removeListener(\"roomStateChange\", handleRoomStateChange);\n    };\n  }, []);\n  return { roomState };\n};\n","import { ChangeEvent, useCallback, useEffect, useState } from \"react\";\nimport { streamManager } from \"../../../common\";\n\nexport const useDevice = () => {\n  const [videoDevices, setVideoDevices] = useState<MediaDeviceInfo[]>([]);\n  const [audioDevices, setAudioDevices] = useState<MediaDeviceInfo[]>([]);\n\n  const [videoSelected, setVideoSelected] = useState(\"\");\n  const [audioSelected, setAudioSelected] = useState(\"\");\n\n  const handleDeviceChange = useCallback(() => {\n    window.navigator.mediaDevices.enumerateDevices().then((devices) => {\n      setVideoDevices(devices.filter((d) => d.kind === \"videoinput\"));\n      setAudioDevices(devices.filter((d) => d.kind === \"audioinput\"));\n    });\n  }, []);\n  useEffect(() => {\n    streamManager\n      .requestPermission()\n      .then(() => {\n        handleDeviceChange();\n      })\n      .catch((e) => {\n        console.error(\"request permission error !!!\", e);\n      });\n\n    window.navigator.mediaDevices.addEventListener(\n      \"devicechange\",\n      handleDeviceChange\n    );\n    return () => {\n      window.navigator.mediaDevices.removeEventListener(\n        \"devicechange\",\n        handleDeviceChange\n      );\n    };\n  }, [handleDeviceChange]);\n\n  const handleVideoSelect = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.value) {\n      setVideoSelected(e.target.value);\n    }\n  }, []);\n\n  const handleAudioSelect = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.value) {\n      setAudioSelected(e.target.value);\n    }\n  }, []);\n\n  const handleReset = useCallback(() => {\n    setVideoSelected(\"\");\n    setAudioSelected(\"\");\n  }, []);\n\n  return {\n    videoSelected,\n    audioSelected,\n    videoDevices,\n    audioDevices,\n    handleVideoSelect,\n    handleAudioSelect,\n    handleReset,\n  };\n};\n","import { FC, useMemo, useState } from \"react\";\nimport { Producer } from \"./pages\";\nimport { BrowserRouter, Route, Routes } from \"react-router-dom\";\nimport { Box, createTheme } from \"@mui/material\";\nimport { ThemeProvider } from \"@mui/system\";\nimport { ColorModeContext, Header } from \"./components\";\n\nconst App: FC = () => {\n  const [mode, setMode] = useState<\"light\" | \"dark\">(\"dark\");\n  const colorMode = useMemo(\n    () => ({\n      toggleColorMode: () => {\n        setMode((prevMode) => (prevMode === \"light\" ? \"dark\" : \"light\"));\n      },\n    }),\n    []\n  );\n\n  const theme = useMemo(\n    () =>\n      createTheme({\n        palette: {\n          mode,\n        },\n      }),\n    [mode]\n  );\n\n  return (\n    <BrowserRouter>\n      <ColorModeContext.Provider value={colorMode}>\n        <ThemeProvider theme={theme}>\n          <Box\n            sx={{\n              bgcolor: \"background.default\",\n              height: \"100vh\",\n              overflow: \"auto\",\n            }}\n          >\n            <Header />\n            <Routes>\n              <Route path=\"/one-on-one\" element={<Producer />} />\n            </Routes>\n          </Box>\n        </ThemeProvider>\n      </ColorModeContext.Provider>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}